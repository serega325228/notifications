{% extends "base.html" %}
{% block title %}–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ{% endblock %}

{% block content %}
<div class="card">
    <h2>üì£ –ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h2>

    <form id="event-form">
        <label>
            <span>–ó–∞–≥–æ–ª–æ–≤–æ–∫</span>
            <input type="text" name="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" required>
        </label>

        <label>
            <span>–°–æ–æ–±—â–µ–Ω–∏–µ</span>
            <textarea name="message" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è" required></textarea>
        </label>

        <label>
            <span>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
            <select name="category">
                <option value="general">general (–≤—Å–µ–º)</option>
            </select>
        </label>

        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
    </form>
</div>

<script>
document.getElementById("event-form").addEventListener("submit", async (e) => {
    e.preventDefault()

    const form = e.target
    const button = form.querySelector('button')
    const originalText = button.textContent
    
    button.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...'
    button.disabled = true

    try {
        const payload = {
            title: form.title.value,
            message: form.message.value,
            category: form.category.value,
        }

        const response = await fetch("/api/events/custom", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload),
        })

        if (response.ok) {
            form.reset()
            button.textContent = '‚úì –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!'
            setTimeout(() => {
                button.textContent = originalText
            }, 2000)
        } else {
            throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏')
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–±—ã—Ç–∏—è')
        console.error(error)
    } finally {
        button.disabled = false
    }
})
</script>
{% endblock %}